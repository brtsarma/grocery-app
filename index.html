<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grocery App PWA with Firebase</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#3b82f6">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="icon-192.png">
<style>
  .checked { text-decoration: line-through; opacity: 0.6; filter: blur(0.5px); transition: all 0.3s ease; }
  .slider-container { overflow: hidden; width: 100%; position: relative; }
  .slider-track { display: flex; transition: transform 0.4s ease; width: 100%; }
  .store-card { min-width: 100%; max-width: 100%; box-sizing: border-box; padding: 1rem; display: flex; flex-direction: column; }
  .arrow-btn { position: absolute; top: 50%; transform: translateY(-50%); background: white; padding: 0.5rem 0.75rem; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,.2); font-size: 24px; cursor: pointer; z-index: 10; }
  .arrow-left { left: 0.5rem; }
  .arrow-right { right: 0.5rem; }
</style>
<script type="module">
  import { groceryRef, set, onValue } from './firebase.js';
  window.firebaseRefs = { groceryRef, set, onValue };
</script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100">

<div id="root"></div>

<script type="text/babel">

function GroceryApp() {
  const { groceryRef, set, onValue } = window.firebaseRefs;

  const defaultData = {
    Winco: ["Seeds","Nuts"],
    Walmart: ["Strawberry","Blueberry","Cilantro","Bell pepper","Cucumber","Organic spinach","Iceberg cabbage","Tomatoes","Avocados","Onion","Potatoes","Garlic","Cherry tomatoes","Banana","Chicken Breast","Organic mozzarella cheese sticks","Baby Bel","Tea milk","Probiotic Yogurt","Taco Fire Sauce","Salad dressing"],
    Sams: ["Protein bar","Once upon a Farm Pouch","Salmon","Wipes","Diaper","Cottage cheese","Lance Peanut biscuit","Cauliflower","Mushroom","Capsicum","Asparagus","Iceberg cabbage","Tea Milk","Organic Milk","Organic Egg"],
    Costco: ["Fish","Aussie Bites"],
    IndiaBazar: ["Dhaniya","Thorai Packet"]
  };

  const [data, setData] = React.useState({});
  const [masterData, setMasterData] = React.useState({});
  const [newItemText, setNewItemText] = React.useState({});
  const [currentStoreIndex, setCurrentStoreIndex] = React.useState(0);
  const storeNames = Object.keys(defaultData);

  React.useEffect(() => {
    onValue(groceryRef, snapshot => {
      const val = snapshot.val() || {};
      const loadedData = {};
      Object.keys(defaultData).forEach(store => {
        loadedData[store] = (val[store] || defaultData[store]).map(i => 
          typeof i === 'string' ? {name:i, checked:false} : i
        );
      });
      setData(loadedData);
      setMasterData(loadedData);
      set(groceryRef, loadedData);
    });
  }, []);

  const saveToFirebase = (newData) => set(groceryRef, newData);

  const handleCheck = (store, itemName) => {
    const newData = {...data};
    newData[store] = newData[store].map(item => 
      item.name === itemName ? {...item, checked: !item.checked} : item
    );
    setData(newData);
    saveToFirebase(newData);
  };

  const addItem = (store, text) => {
    if(!text) return;
    const newItems = text.split(',').map(i=>i.trim()).filter(Boolean).map(i=>({name:i, checked:false}));
    const newData = {...data, [store]: [...data[store], ...newItems]};
    const newMaster = {...masterData, [store]: [...masterData[store], ...newItems]};
    setData(newData);
    setMasterData(newMaster);
    setNewItemText(prev => ({...prev, [store]: ''}));
    saveToFirebase(newData);
  };

  const deleteItem = (itemName) => {
    const newData = {};
    Object.keys(data).forEach(store => {
      newData[store] = data[store].filter(item => item.name !== itemName);
    });
    setData(newData);
    saveToFirebase(newData);
  };

  const resetList = () => {
    setData(masterData);
    saveToFirebase(masterData);
  };

  const prevStore = () => setCurrentStoreIndex(i => Math.max(i-1,0));
  const nextStore = () => setCurrentStoreIndex(i => Math.min(i+1, storeNames.length-1));

  return (
    <div className="max-w-3xl mx-auto p-4">
      <h1 className="text-3xl font-bold mb-4 text-center">Grocery List</h1>
      <button onClick={resetList} className="mb-4 bg-blue-600 text-white px-4 py-2 rounded-xl shadow">RESET LIST</button>

      <div className="slider-container relative">
        <div className="slider-track" style={{transform: `translateX(-${currentStoreIndex*100}%)`}}>
          {storeNames.map(store => (
            <div key={store} className="store-card bg-white rounded-2xl shadow p-4">
              <h2 className="text-xl font-semibold mb-2">{store}</h2>
              <div className="flex flex-wrap gap-2 mt-2">
                <input type="text" placeholder="Add item(s), comma separated" value={newItemText[store]||''} onChange={e=>setNewItemText(prev=>({...prev,[store]:e.target.value}))} className="flex-1 min-w-[150px] border rounded px-2 py-1"/>
                <button onClick={()=>addItem(store,newItemText[store])} className="bg-green-600 text-white px-3 py-1 rounded">Add</button>
              </div>
              <ul className="mt-2 space-y-2">
                {data[store]?.map(item => (
                  <li key={item.name} className="flex justify-between items-center">
                    <div className="flex items-center gap-2">
                      <input type="checkbox" checked={item.checked} onChange={()=>handleCheck(store,item.name)} className="h-5 w-5"/>
                      <span className={`text-lg ${item.checked ? 'checked' : ''}`}>{item.name}</span>
                    </div>
                    <button onClick={()=>deleteItem(item.name)} className="text-red-600 hover:text-red-800 shrink-0">
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fillRule="evenodd" d="M6 2a1 1 0 00-1 1v1H3a1 1 0 000 2h14a1 1 0 100-2h-2V3a1 1 0 00-1-1H6zm2 5a1 1 0 011 1v7a1 1 0 11-2 0V8a1 1 0 011-1zm4 0a1 1 0 011 1v7a1 1 0 11-2 0V8a1 1 0 011-1z" clipRule="evenodd"/>
                      </svg>
                    </button>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>
        <div className="arrow-btn arrow-left" onClick={prevStore}>‹</div>
        <div className="arrow-btn arrow-right" onClick={nextStore}>›</div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<GroceryApp />);
</script>
</body>
</html>
